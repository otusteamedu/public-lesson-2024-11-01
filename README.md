# Репозиторий для [публичного урока](https://otus.ru/lessons/symfony/#event-4895) по курсу [Symfony Framework](https://otus.ru/lessons/symfony/)

## Инициализация проекта

1. Запустить контейнеры командой `docker-compose up -d`
2. Войти в контейнер командой `docker exec -it php sh`
3. Установить необходимые пакеты командой `composer install`
4. Инициализировать БД командой `php bin/console doctrine:migrations:migrate`

## Запуск эксперимента 

  - Запустить фоновую команду `php bin/console lock:background &`
  - После вывода сообщения `Background ready, pid XXX` запустить основную команду:
    - В оптимистичном режиме `php bin/console lock:main`
    - В пессимистичном режиме `php bin/conosle lock:main -p`
  - Для настройки вероятности race condition нужно передать в фоновую команду опцию `--prob=P`, где `P` – вероятность
    в процентах. Обработки невалидных значений в команде нет
  - Также можно настроить время, необходимое на выполнение различных операций с помощью опций:
    - `--operation=X`, где `X` – время на операци записи в микросекундах. Нужно задать одинаковым для фоновой и основной
      команд
    - `--refresh=Y`, где `Y` – время на обработку ошибочной ситуации в микросекундах в оптимистичном режиме, задаётся
      только для основной команды
    - `--lock=Z`, где `Z` – время на проверку / установку блокировки в пессимистичном режиме, задаётся только для
      основной команды

Автор: [Михаил Каморин](mailto:m.v.kamorin@gmail.com)
